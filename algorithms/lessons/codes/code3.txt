var canvas = document.getElementById("myCanvas"); // ğŸ¨ è·å–é¡µé¢ä¸Šçš„ç”»å¸ƒå…ƒç´ ï¼Œè®©æˆ‘ä»¬å¼€å§‹åˆ›ä½œå§ï¼
var ctx = canvas.getContext("2d"); // âœï¸ è·å–2Dç»˜å›¾ç¯å¢ƒï¼Œå‡†å¤‡å¥½ç”»ç¬”å’¯ï¼
ctx.clearRect(0, 0, 500, 500); // ğŸ§¼ æ¸…é™¤ç”»å¸ƒä¸Šçš„å†…å®¹ï¼Œä¸ºæ–°ç»˜åˆ¶çš„å›¾å½¢è…¾å‡ºç©ºé—´

var image = new Image(); // ğŸ–¼ï¸ åˆ›å»ºä¸€ä¸ªæ–°çš„å›¾åƒå¯¹è±¡
image.src = '/resources/star.png'; // ğŸŒŸ è®¾ç½®å›¾åƒæºè·¯å¾„ä¸ºæ˜Ÿæ˜Ÿå›¾ç‰‡çš„è·¯å¾„

var pixels = []; // ğŸ–Œï¸ åˆ›å»ºä¸€ä¸ªæ•°ç»„æ¥å­˜å‚¨åƒç´ æ•°æ®
var imageData; // ğŸ“¸ ç”¨äºå­˜å‚¨å›¾åƒçš„åƒç´ æ•°æ®

image.onload = function() {
    // ğŸ–Œï¸ å½“å›¾åƒåŠ è½½å®Œæˆæ—¶æ‰§è¡Œ
    ctx.drawImage(image, 200, 100, 200, 200); // ğŸŒŸ åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶å›¾åƒï¼ˆä½ç½®ï¼šx=200, y=100ï¼Œå°ºå¯¸ï¼š200x200ï¼‰
    imageData = ctx.getImageData(200, 100, 200, 200); // ğŸ“¸ è·å–å›¾åƒçš„åƒç´ æ•°æ®
    getPixels(); // ğŸŒˆ è·å–æ‰€æœ‰åƒç´ ä¿¡æ¯
    drawPic(); // ğŸ¨ ç»˜åˆ¶å›¾åƒ
};

function getPixels() {
    var pos = 0;
    var data = imageData.data; // ğŸ–¼ï¸ RGBAçš„ä¸€ç»´æ•°ç»„æ•°æ®

    // ğŸ“ æºå›¾åƒçš„é«˜åº¦å’Œå®½åº¦ä¸º200px
    for (var i = 1; i <= 200; i++) {
        for (var j = 1; j <= 200; j++) {
            pos = [(i - 1) * 200 + (j - 1)] * 4; // ğŸ“ è®¡ç®—åƒç´ ä½ç½®

            if (data[pos] >= 0) { // ğŸŒŸ åªå¤„ç†æœ‰æ•ˆåƒç´ 
                var pixel = {
                    x: 200 + j + Math.random() * 20, // ğŸ¯ é‡æ–°è®¾ç½®æ¯ä¸ªåƒç´ çš„ä½ç½®ä¿¡æ¯ï¼ŒåŠ ä¸Šéšæœºåç§»
                    y: 100 + i + Math.random() * 20, // ğŸ¯ é‡æ–°è®¾ç½®æ¯ä¸ªåƒç´ çš„ä½ç½®ä¿¡æ¯ï¼ŒåŠ ä¸Šéšæœºåç§»
                    fillStyle: 'rgba(' + data[pos] + ',' + (data[pos + 1]) + ',' + (data[pos + 2]) + ',' + (data[pos + 3]) + ')' // ğŸ¨ è®¾ç½®åƒç´ é¢œè‰²
                };
                pixels.push(pixel); // ğŸ—‚ï¸ å°†åƒç´ å¯¹è±¡æ·»åŠ åˆ°æ•°ç»„ä¸­
            }
        }
    }
}

function drawPic() {
    // var canvas = document.getElementById("myCanvas"); // ğŸ¨ å†æ¬¡è·å–ç”»å¸ƒå…ƒç´ 
    // var ctx = canvas.getContext("2d"); // âœï¸ è·å–2Dç»˜å›¾ç¯å¢ƒ
    clearInterval();
    ctx.clearRect(0, 0, 500, 500); // ğŸ§¼ æ¸…é™¤ç”»å¸ƒä¸Šçš„å†…å®¹ï¼Œä¸ºæ–°ç»˜åˆ¶çš„å›¾å½¢è…¾å‡ºç©ºé—´

    var len = pixels.length; // ğŸŒŸ è·å–åƒç´ æ•°æ®çš„é•¿åº¦
    var curr_pixel = null;

    for (var i = 0; i < len; i++) {
        curr_pixel = pixels[i]; // ğŸ“ è·å–å½“å‰åƒç´ 
        
        ctx.fillStyle = curr_pixel.fillStyle; // ğŸ¨ è®¾ç½®åƒç´ é¢œè‰²
        ctx.fillRect(curr_pixel.x, curr_pixel.y, 1, 1); // ğŸ–Œï¸ ç»˜åˆ¶åƒç´ ï¼ˆä¸€ä¸ªå°çŸ©å½¢ï¼‰
    }
}
